<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gyan Mandala Nepal — Learning Portal</title>
  <meta name="description" content="Interactive learning portal — classes, subjects, and lessons for Gyan Mandala Nepal." />
  <style>
    /* ============================
       Design tokens & base
       ============================ */
    :root{
      --bg1:#f7fbff;
      --bg2:#e9f6fb;
      --card:#ffffff;
      --muted:#6b7280;
      --glass: rgba(255,255,255,0.6);
      --accent1:#b03a2e; /* Nepal-inspired red */
      --accent2:#ff8c2a; /* saffron */
      --accent3:#0b6fa4; /* deep blue */
      --accent4:#2aa87a; /* green (science) */
      --radius:14px;
      --shadow-lg: 0 18px 50px rgba(8,18,40,0.12);
      --soft: 0 8px 30px rgba(12,34,56,0.06);
      --ease: cubic-bezier(.22,.9,.38,1);
      --max-width:1100px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: linear-gradient(160deg,var(--bg1),var(--bg2));
      color:#0b1220;
      display:flex;
      flex-direction:column;
    }

    /* ============================
       Header / logo
       ============================ */
    header{
      position:relative;
      padding:14px 20px;
      background: linear-gradient(0deg, rgba(255,255,255,0.55), rgba(255,255,255,0.45));
      backdrop-filter: blur(6px);
      box-shadow: var(--soft);
      z-index:40;
    }
    .logo{
      position:absolute;
      right:18px;
      top:18px;             /* slightly lowered as requested */
      width:72px;           /* small and neat */
      border-radius:10px;
      cursor:pointer;
      transition: transform .18s var(--ease), box-shadow .18s var(--ease);
    }
    .logo:focus, .logo:hover{ transform: translateY(-2px) scale(1.02); box-shadow:0 8px 28px rgba(12,34,56,0.12); }

    main{flex:1; width:100%; max-width:var(--max-width); margin:18px auto; padding:0 20px 80px;} /* footer leaves space */

    /* ============================
       Pages + transitions
       ============================ */
    .page{ display:none; opacity:0; transform: translateY(8px); transition: all .42s var(--ease); }
    .page.active{ display:block; opacity:1; transform: translateY(0); }

    /* nice slide in/out */
    .page-enter{ animation: slideIn .36s var(--ease) forwards; }
    .page-exit{ animation: slideOut .28s var(--ease) forwards; }
    @keyframes slideIn{ from{opacity:0; transform:translateY(8px);} to{opacity:1; transform:translateY(0);} }
    @keyframes slideOut{ from{opacity:1; transform:translateY(0);} to{opacity:0; transform:translateY(-8px);} }

    /* ============================
       Home: animated greeting
       ============================ */
    .welcome{
      margin-top:44px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:12px;
    }
    .welcome-line{
      font-weight:800;
      line-height:1;
      text-align:center;
      font-size:clamp(28px,6vw,48px);
      opacity:0;
      transform: translateY(12px);
      animation: fadeUp .56s var(--ease) forwards;
      text-shadow: 0 2px 0 rgba(255,255,255,0.1);
    }
    .w1{ color: var(--accent1); animation-delay: .12s; letter-spacing: -0.5px;}
    .w2{ color: var(--accent2); animation-delay: .34s;}
    .w3{ color: var(--accent3); animation-delay: .58s;}
    @keyframes fadeUp{ to{opacity:1; transform:translateY(0);} }

    .subtitle{ color:var(--muted); font-size:16px; margin-top:8px; text-align:center; max-width:780px; }

    .hero-actions{ margin-top:20px; display:flex; gap:12px; justify-content:center; align-items:center; }

    .btn{
      padding:12px 18px;
      border-radius:12px;
      border:0;
      cursor:pointer;
      font-weight:700;
      transition: transform .12s var(--ease), box-shadow .12s var(--ease);
    }
    .btn-primary{ background: linear-gradient(90deg,var(--accent2),var(--accent1)); color:#fff; box-shadow: 0 10px 30px rgba(176,58,46,0.12); }
    .btn-primary:hover{ transform: translateY(-3px); box-shadow: 0 18px 42px rgba(176,58,46,0.14); }
    .btn-ghost{ background:transparent; border:2px solid rgba(12,34,56,0.06); color:var(--accent3); }

    /* ============================
       Card / form
       ============================ */
    .card{
      background: var(--card);
      border-radius: var(--radius);
      padding:24px;
      box-shadow: var(--shadow-lg);
      margin:26px auto;
      max-width:880px;
    }
    h2{ margin:0; font-size:20px; }
    .muted{ color:var(--muted); }

    form{ display:flex; flex-wrap:wrap; gap:14px; margin-top:12px; align-items:flex-start; }
    .field{ display:flex; flex-direction:column; gap:8px; min-width:220px; width:calc(50% - 16px); }
    .field.full{ width:100%; }
    label{ font-size:14px; color:var(--muted); font-weight:600; }
    input[type="text"], select{
      padding:12px 14px;
      border-radius:10px;
      border:1px solid #e6eef7;
      font-size:15px;
      outline:none;
      transition: box-shadow .12s var(--ease), border-color .12s var(--ease);
      background:linear-gradient(180deg,#fff,#fbfdff);
    }
    input:focus, select:focus{ box-shadow:0 10px 28px rgba(11,111,164,0.06); border-color:#cbe8ff; }

    .hint{ font-size:13px; color:#8b96a8; }

    /* ============================
       Breadcrumb & lessons
       ============================ */
    .breadcrumb{ display:flex; gap:10px; align-items:center; color:var(--muted); margin-bottom:12px; font-size:14px; }
    .breadcrumb a{ color:var(--accent3); text-decoration:none; font-weight:700; cursor:pointer; }

    .lessons-grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:14px;
      margin-top:12px;
    }
    @media (max-width:1000px){ .lessons-grid{ grid-template-columns: repeat(3,1fr); } }
    @media (max-width:700px){ .lessons-grid{ grid-template-columns: repeat(2,1fr); } }

    .lesson{
      display:flex;
      gap:12px;
      align-items:center;
      background:linear-gradient(180deg,#fff,#fbfdff);
      border-radius:12px;
      padding:12px;
      border:1px solid rgba(0,0,0,0.04);
      cursor:pointer;
      transition: transform .12s var(--ease), box-shadow .12s var(--ease), background .12s var(--ease);
      box-shadow: var(--soft);
    }
    .lesson:hover{ transform: translateY(-6px) scale(1.01); box-shadow: 0 22px 48px rgba(12,34,56,0.09); }
    .lesson-icon{ width:44px; height:44px; border-radius:10px; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; flex:0 0 44px; }
    .lesson-meta{ display:flex; flex-direction:column; }
    .lesson-title{ font-weight:700; }
    .lesson-sub{ font-size:13px; color:var(--muted); margin-top:4px; }

    /* color accents by subject (includes hamro) */
    .sub-maths .lesson-icon{ background: linear-gradient(135deg,#70b6ff,#4a90e2); }
    .sub-english .lesson-icon{ background: linear-gradient(135deg,#ffd27c,#ff9a3d); }
    .sub-science .lesson-icon{ background: linear-gradient(135deg,#8de28a,#2aa87a); }
    .sub-social .lesson-icon{ background: linear-gradient(135deg,#f196b8,#ec5a9a); }
    .sub-nepali .lesson-icon{ background: linear-gradient(135deg,#b03a2e,#8b1f1f); }
    .sub-hamro .lesson-icon{ background: linear-gradient(135deg,#ffcc66,#cc6600); }

    /* ============================
       Modal overlay
       ============================ */
    .overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(8,12,20,0.42); z-index:80; }
    .overlay.open{ display:flex; }
    .modal{ background: #fff; border-radius:12px; padding:18px; width:min(680px,92%); box-shadow: 0 28px 80px rgba(8,18,40,0.22); }
    .modal h3{ margin:0; }
    .modal .meta{ color:var(--muted); font-size:14px; margin-top:6px; }

    /* ============================
       Footer bottom
       ============================ */
    footer{
      position:fixed;
      left:0; right:0; bottom:0;
      background: linear-gradient(90deg,var(--accent3),#06607f);
      color:#fff;
      padding:12px 18px;
      text-align:center;
      font-weight:600;
      box-shadow: 0 -6px 22px rgba(2,22,40,0.08);
    }

    /* small helpers */
    .center{ display:flex; justify-content:center; align-items:center; }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <header>
    <!-- clickable logo top-right -->
    <img id="siteLogo" src="GMN Logo.png" alt="GMN Logo" class="logo" tabindex="0" title="Back to Home (Gyan Mandala Nepal)">
  </header>

  <main>
    <!-- ===== HOME ===== -->
    <section id="homePage" class="page active" aria-labelledby="homeTitle">
      <div class="welcome" role="banner">
        <div id="homeTitle" class="welcome-line w1">Welcome</div>
        <div class="welcome-line w2">to</div>
        <div class="welcome-line w3">Gyan Mandala Nepal</div>
      </div>

      <p class="subtitle center" style="max-width:820px;">
        A friendly, modern learning portal — designed for clarity, accessibility, and delight.
        Choose your class and subject to explore lessons crafted for every learner.
      </p>

      <div class="hero-actions">
        <button id="enterPortal" class="btn btn-primary" aria-haspopup="true">Go to Learning Portal</button>
        <button id="demoInfo" class="btn btn-ghost" onclick="alert('Demo: select class & subject to auto-open lessons.');">How it works</button>
      </div>
    </section>

    <!-- ===== FORM / SELECTION ===== -->
    <section id="formPage" class="page" aria-labelledby="formTitle" tabindex="-1">
      <div class="card" role="region" aria-labelledby="formTitle">
        <h2 id="formTitle">Enter Your Details</h2>
        <p class="muted">Select class and subject below. When both are chosen we automatically open the lesson page.</p>

        <form id="studentForm" onsubmit="return false;" aria-describedby="formDesc">
          <div class="field full">
            <label for="schoolName">School Name</label>
            <input id="schoolName" type="text" placeholder="e.g., Gyan Mandala Higher School" />
            <div class="hint">Optional — saved in your session for convenience.</div>
          </div>

          <div class="field">
            <label for="studentName">Student Name</label>
            <input id="studentName" type="text" placeholder="Student name (optional)" />
          </div>

          <div class="field">
            <label for="grade">Class (1 - 10)</label>
            <select id="grade" required aria-required="true">
              <option value="">Select class</option>
              <!-- filled by script -->
            </select>
          </div>

          <div class="field">
            <label for="subject">Subject</label>
            <select id="subject" required aria-required="true">
              <option value="">Select subject</option>
              <!-- dynamic by grade -->
            </select>
          </div>

          <div class="field full center" style="margin-top:12px;">
            <div class="muted small">Selections auto-navigate — you may change them anytime via breadcrumb.</div>
          </div>
        </form>
      </div>
    </section>

    <!-- ===== LESSONS PAGE (dynamic) ===== -->
    <section id="lessonsPage" class="page" aria-labelledby="lessonsTitle" tabindex="-1">
      <div style="max-width:var(--max-width); margin:0 auto;">
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a id="crumbHome" role="link">Home</a>
          <span>›</span>
          <a id="crumbClass" role="link" style="text-decoration:underline; cursor:pointer;">Class</a>
          <span>›</span>
          <span id="crumbSubject" style="font-weight:700;"></span>
        </nav>

        <header style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <h2 id="lessonsTitle" style="margin:0;">Lessons</h2>
            <div class="muted small" id="lessonsIntro">Choose a lesson — preview modal opens for demo content.</div>
          </div>
          <div class="muted small">20 interactive lessons • responsive • accessible</div>
        </header>

        <div id="lessonsGrid" class="lessons-grid" role="list" aria-labelledby="lessonsTitle" style="margin-top:18px;">
          <!-- injected buttons -->
        </div>
      </div>
    </section>
  </main>

  <footer>© 2025 Gyan Mandala Nepal, All Rights Reserved</footer>

  <!-- Lesson Modal -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Lesson</h3>
      <div class="meta" id="modalMeta">Subject • Class</div>
      <p id="modalBody" style="margin-top:12px;color:#334155;">This is a demo lesson preview. Replace with actual lesson content or route to a lesson page. Buttons can link to video, reading, quiz or downloadable resources.</p>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:14px;">
        <button class="btn btn-ghost" onclick="closeModal()">Close</button>
        <button class="btn btn-primary" onclick="alert('Open full lesson — demo')">Open Lesson</button>
      </div>
    </div>
  </div>

  <script>
    /************************************************************************
     * App state & subject mapping per grade (updated per your request)
     ************************************************************************/
    const state = {
      current: 'home', // 'home' | 'form' | 'lessons'
      grades: Array.from({length:10}, (_,i) => i+1), // 1..10
      // subjects by group:
      subjectsLow: [ // grades 1-3
        { id:'maths', name:'Mathematics' },
        { id:'english', name:'English' },
        { id:'hamro', name:'Hamro Serophero' },
        { id:'nepali', name:'Nepali' }
      ],
      subjectsHigh: [ // grades 4-10
        { id:'maths', name:'Mathematics' },
        { id:'english', name:'English' },
        { id:'science', name:'Science' },
        { id:'nepali', name:'Nepali' },
        { id:'social', name:'Social Studies' }
      ],
      // friendly name map for rendering
      subjectNames: {
        maths:'Mathematics', english:'English', hamro:'Hamro Serophero',
        nepali:'Nepali', science:'Science', social:'Social Studies'
      }
    };

    // shorthand selectors
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    /************************************************************************
     * Page show/hide with transitions
     ************************************************************************/
    function showPage(pageId){
      const map = { home:'#homePage', form:'#formPage', lessons:'#lessonsPage' };
      if(state.current === pageId) return;
      const from = document.querySelector(map[state.current]);
      const to = document.querySelector(map[pageId]);
      if(!to) return;

      // exit animation
      if(from){
        from.classList.remove('active');
        from.classList.add('page-exit');
        setTimeout(()=> from.classList.remove('page-exit'), 360);
      }

      to.classList.add('active', 'page-enter');
      setTimeout(()=> to.classList.remove('page-enter'), 420);
      state.current = pageId;

      // focus for accessibility
      setTimeout(()=> to.focus && to.focus(), 200);
    }

    /************************************************************************
     * Navigation guards using sessionStorage
     ************************************************************************/
    function setVisitedHome(){ sessionStorage.setItem('visitedHome','1'); }
    function setVisitedForm(){ sessionStorage.setItem('visitedForm','1'); }
    function allowedForm(){ return sessionStorage.getItem('visitedHome') === '1'; }
    function allowedLessons(){ return sessionStorage.getItem('visitedForm') === '1'; }

    /************************************************************************
     * Populate grade dropdown and bind events
     ************************************************************************/
    document.addEventListener('DOMContentLoaded', () => {
      // populate grade
      const gradeEl = $('#grade');
      state.grades.forEach(g => {
        const opt = document.createElement('option');
        opt.value = g;
        opt.textContent = `Class ${g}`;
        gradeEl.appendChild(opt);
      });

      // logo click returns to home (clears session flags)
      $('#siteLogo').addEventListener('click', () => {
        sessionStorage.clear();
        navigateHome();
      });
      $('#siteLogo').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') { sessionStorage.clear(); navigateHome(); }
      });

      // go portal button
      $('#enterPortal').addEventListener('click', () => {
        setVisitedHome();
        navigateForm();
      });

      // breadcrumbs
      $('#crumbHome').addEventListener('click', () => { sessionStorage.clear(); navigateHome(); });
      $('#crumbClass').addEventListener('click', () => {
        // jump back to form while preserving selections
        location.hash = '#form';
        showPage('form');
      });

      // grade change updates subject options
      $('#grade').addEventListener('change', (e) => {
        updateSubjectsForGrade(parseInt(e.target.value));
        handleAutoNavigate();
      });
      $('#subject').addEventListener('change', handleAutoNavigate);

      // initialize based on URL hash (protects direct access)
      handleInitialHash();
    });

    /************************************************************************
     * Determine subject list based on grade
     ************************************************************************/
    function updateSubjectsForGrade(grade){
      const subjEl = $('#subject');
      subjEl.innerHTML = '<option value="">Select subject</option>';
      if(!grade) return;
      const list = grade <= 3 ? state.subjectsLow : state.subjectsHigh;
      list.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.id;
        opt.textContent = s.name;
        subjEl.appendChild(opt);
      });
    }

    /************************************************************************
     * Auto navigation when both grade & subject chosen
     ************************************************************************/
    let autoTimer = null;
    function handleAutoNavigate(){
      if(!allowedForm()) { navigateHome(); return; }
      const grade = parseInt($('#grade').value);
      const subject = $('#subject').value;
      if(grade && subject){
        if(autoTimer) clearTimeout(autoTimer);
        autoTimer = setTimeout(()=> {
          // validate combination
          if(!isValidCombination(grade, subject)){ alert('Invalid class-subject combination.'); return; }
          setVisitedForm();
          navigateLessons(grade, subject);
        }, 360);
      }
    }

    /************************************************************************
     * Validate class-subject combos with updated mapping
     ************************************************************************/
    function isValidCombination(grade, subjectId){
      const low = state.subjectsLow.map(s => s.id);
      const high = state.subjectsHigh.map(s => s.id);
      if(grade <= 3) return low.includes(subjectId);
      return high.includes(subjectId);
    }

    /************************************************************************
     * Navigation helpers
     ************************************************************************/
    function navigateHome(){
      location.hash = '';
      showPage('home');
    }
    function navigateForm(){
      if(!allowedForm()){ navigateHome(); return; }
      location.hash = '#form';
      showPage('form');
    }
    function navigateLessons(grade, subjectId){
      if(!allowedLessons() || !isValidCombination(grade, subjectId)){ navigateHome(); return; }
      // set hash for shareability (still guarded)
      location.hash = `#lessons/class-${grade}/${subjectId}`;
      renderLessons(grade, subjectId);
      showPage('lessons');
    }

    /************************************************************************
     * Render lessons page: 20 uniform interactive buttons
     ************************************************************************/
    function renderLessons(grade, subjectId){
      // update breadcrumb & header
      $('#crumbClass').textContent = `Class ${grade}`;
      $('#crumbSubject').textContent = state.subjectNames[subjectId] || subjectId;
      $('#lessonsIntro').textContent = `Showing 20 lessons for ${state.subjectNames[subjectId]} • Class ${grade}`;

      // add class on page for subject coloring
      const lessonsPage = $('#lessonsPage');
      lessonsPage.classList.remove('sub-maths','sub-english','sub-science','sub-social','sub-nepali','sub-hamro');
      lessonsPage.classList.add(`sub-${subjectId}`);

      const grid = $('#lessonsGrid');
      grid.innerHTML = ''; // clear

      const icons = { book: '📘', video: '🎬', quiz: '📝' };
      const types = ['book','video','quiz'];

      for(let i=1;i<=20;i++){
        const t = types[(i-1)%types.length];
        const btn = document.createElement('button');
        btn.className = 'lesson';
        btn.setAttribute('role','listitem');
        btn.innerHTML = `
          <div class="lesson-icon" aria-hidden="true">${icons[t]}</div>
          <div class="lesson-meta">
            <div class="lesson-title">Lesson ${i}</div>
            <div class="lesson-sub">${capitalize(t)} • Class ${grade} • ${state.subjectNames[subjectId]}</div>
          </div>
        `;
        // click opens modal for demo
        btn.addEventListener('click', ()=> openModal(grade, subjectId, i, t));
        grid.appendChild(btn);
      }

      // scroll top & focus
      window.scrollTo({ top: 0, behavior: 'smooth' });
      setTimeout(()=> $('#lessonsGrid').focus && $('#lessonsGrid').focus(), 220);
    }

    /************************************************************************
     * Modal: lesson preview
     ************************************************************************/
    function openModal(grade, subjectId, lessonNum, type){
      $('#modalTitle').textContent = `Lesson ${lessonNum}`;
      $('#modalMeta').textContent = `${state.subjectNames[subjectId]} • Class ${grade} • ${capitalize(type)}`;
      $('#modalBody').textContent = `Demo preview for Lesson ${lessonNum}. Replace this with the lesson's actual content (text, video, exercises). This portal dynamically generates pages for valid class-subject pairs.`;
      $('#overlay').classList.add('open');
      $('#overlay').setAttribute('aria-hidden','false');
    }
    function closeModal(){
      $('#overlay').classList.remove('open');
      $('#overlay').setAttribute('aria-hidden','true');
    }
    $('#overlay').addEventListener('click', (e)=> { if(e.target === $('#overlay')) closeModal(); });
    document.addEventListener('keyup', (e)=> { if(e.key === 'Escape') closeModal(); });

    /************************************************************************
     * Helpers & initial hash handling (guards direct access)
     ************************************************************************/
    function capitalize(s){ return s.charAt(0).toUpperCase() + s.slice(1); }

    function handleInitialHash(){
      const hash = location.hash || '';
      if(!hash){ navigateHome(); return; }

      if(hash.startsWith('#form')){
        // only if visitedHome
        if(sessionStorage.getItem('visitedHome') === '1'){ showPage('form'); }
        else navigateHome();
        return;
      }

      if(hash.startsWith('#lessons')){
        // parse pattern #lessons/class-<n>/<subject>
        const parts = hash.replace('#lessons/','').split('/');
        if(parts.length === 2){
          const classPart = parts[0].replace('class-','');
          const sub = parts[1];
          const gradeNum = parseInt(classPart);
          if(Number.isInteger(gradeNum) && isValidCombination(gradeNum, sub) && sessionStorage.getItem('visitedForm') === '1'){
            renderLessons(gradeNum, sub);
            showPage('lessons');
            return;
          }
        }
        navigateHome();
        return;
      }

      // unknown -> home
      navigateHome();
    }

    // call after DOM ready
    window.addEventListener('load', () => {
      // ensure welcome animation replay if returning
      $$('.welcome-line').forEach((el)=> { el.style.animation = el.style.animation; });

      // handle initial hash protected by session flags
      handleInitialHash();
    });

    /************************************************************************
     * Clean UX: prevent direct access to form/lessons:
     * when user clicks "Go to Learning Portal" we set visitedHome flag
     ************************************************************************/
    // clicking enterPortal above sets visitedHome and calls navigateForm
    // When navigateForm is called, we set visitedForm after both selections (in handleAutoNavigate)
    // The guards check these session flags.

    /************************************************************************
     * Note for devs:
     * Total generated pages calculation (per updated mapping):
     * Grades 1-3: 3 grades × 4 subjects = 12 pages
     * Grades 4-10: 7 grades × 5 subjects = 35 pages
     * Total = 47 dynamically generated lesson pages (each shows 20 lessons)
     ************************************************************************/
  </script>
</body>
</html>
